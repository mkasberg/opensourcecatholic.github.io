<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Speeding up a Site: Quicker 404 Errors for files in Drupal</title>
  <meta name="description" content="On the Archdiocese of Saint Louis website, we moved thousands of files around as part of our site migration from 49 separate Joomla sites to Drupal. Internal...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.opensourcecatholic.com/2010/speeding-up-a-site-quicker-404-errors-for-files-in-drupal">
  <link rel="alternate" type="application/rss+xml" title="Open Source Catholic" href="http://www.opensourcecatholic.com/rss.xml">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" >
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
</head>


  <body>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2478239-10', 'auto');
  ga('send', 'pageview');

</script>


    <header class="site-header">

  <div class="wrapper">
    <a class="site-title" href="/"><img src="/sites/opensourcecatholic.com/files/airyblue-logo.png" width="100" height="97" alt="Open Source Catholic Logo"> Open Source Catholic</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
        <a class="page-link" href="/about/">About</a>
        
        <a class="page-link" href="/archive/">Archive</a>
        
        <a class="page-link" href="/chat/">Chat</a>
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Speeding up a Site: Quicker 404 Errors for files in Drupal</h1>
    <p class="post-meta">
      <time datetime="2010-04-28T00:00:00+00:00" itemprop="datePublished">Apr 28, 2010</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeff Geerling</span></span>
      
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>On the Archdiocese of Saint Louis website, we moved thousands of files around as part of our <a href="http://archstl.org/commoffice/page/evolution-archdiocesan-website">site migration</a> from 49 separate Joomla sites to Drupal. Internally, all our file links were updated. However, there are thousands of hotlinks from different websites to the Archdiocesan website (for instance, the blog American Papist hits a missing file of a Church interior about 80 times a day).</p>
<p>This was creating a lot of overhead for the server, as Drupal would do a full bootstrap, sending out a fully-rendered 404 page on each missing file request.</p>
<p>Looking to Drupal forums for help, I <a href="http://drupal.org/node/76824#comment-2834536">found some help from kbahey</a>, founder/owner of <a href="http://2bits.com/">2bits</a>, a Drupal shop that specializes in speeding up large Drupal sites. The advice in the issue linked above has the proper code for speeding up requests on a Drupal 7 site, but the code is slightly different for Drupal 6.x. Here&#39;s the code:</p>
<p>&lt;?php
/**</p>
<ul>
  <li>404 Handling, to conserve server resources upon missing image/text/non-html file.
 */
if (preg_match(“/.(txt|png|gif|jpe?g|shtml?|css|js|ico|swf|flv|cgi|bat|pl|dll|exe|asp)$/”, $_SERVER[‘QUERY_STRING’])) {
 header(‘HTTP/1.0 404 Not Found’);
 print ‘&lt;html&gt;&lt;head&gt;<title>404 Not Found</title>&lt;/head&gt;&lt;body&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;p&gt;The requested URL was not found on this server. If you think you reached this page in error, please visit the <a href="http://archstl.org/">Archdiocese of Saint Louis home page</a> and search for the page or file for which you are looking.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;’;
 exit();
}
?&gt;&lt;p&gt;You can simply paste this at the bottom of the settings.php file.&lt;/p&gt;</li>
</ul>
<p>In a nutshell, it does the following: If the request is for a file in it&#39;s list of regular expressions, and the file is not found, it will output 404 headers, along with a simple HTML string.</p>
<p>This is a heck of a lot faster than allowing a full Drupal bootstrap on each missing file request&mdash;an operation which, on our server, takes up a nice 30 MB of RAM, plus a lot extra CPU usage per request, when compared with using the code above.</p>

  </div>


  <div class="post-comments">
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      
        
        this.page.url = "http://www.opensourcecatholic.com/blog/oscatholic/speeding-site-quicker/";
        this.page.identifier = "node/256";
      
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = '//opensourcecatholic.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>



</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Open Source Catholic</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <p class="rss-subscribe">Subscribe <a href="/rss.xml">via RSS</a></p>
        <ul class="social-media-list">
          
          <li>
            <a href="https://groups.google.com/forum/#!forum/open-source-catholic"><i class="fas fa-envelope"></i> <span class="username">open-source-catholic</span></a>

          </li>
          

          
          <li>
            <a href="https://github.com/opensourcecatholic"><i class="fab fa-github"></i> <span class="username">opensourcecatholic</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/oscatholic"><i class="fab fa-twitter"></i> <span class="username">oscatholic</span></a>

          </li>
          

          <li>
            <a href="https://catholicdevs.slack.com"><i class="fab fa-slack"></i> <span class="username">catholicdevs</span></a>

          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <p>Helping Catholic developers and organizations involved in software and web development find effective solutions for spreading the Gospel of Jesus Christ.
</p>
      </div>

    </div>

  </div>

</footer>


    <script id="dsq-count-scr" src="//opensourcecatholic.disqus.com/count.js" async></script>
  </body>

</html>
